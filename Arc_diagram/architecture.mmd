graph TD
    %% Theme: Professional Blue/Tech
    %%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e3f2fd', 'edgeLabelBackground':'#ffffff', 'tertiaryColor': '#f1f8e9', 'lineColor': '#1565c0'}}}%%

    %% Actors & Interface
    User(fa:fa-user User<br>Web Browser)
    
    subgraph Frontend [Streamlit UI]
        direction TB
        UI(fa:fa-laptop Streamlit Dashboard)
        Upload(fa:fa-file-upload Upload PDF)
        UI -.-> Upload
    end

    subgraph DataPipeline [Data Processing & Ingestion Pipeline]
        direction LR
        PyScript(fa:fa-python LangChain Script)
        Chunker(fa:fa-cut Text Chunking)
        Embedder(fa:fa-brain OpenAI Embeddings)
        
        PyScript --> Chunker --> Embedder
    end

    subgraph Knowledge [Elasticsearch Cloud]
        direction TB
        VectorStore[(fa:fa-database Vector Store & RAG)]
        Index[Index: Regulation Vectors]
        VectorStore --- Index
    end

    subgraph Brain [AI Decision Engine]
        direction TB
        Agent(fa:fa-robot AI Agent<br>GPT-4 Turbo)
        Synthesis(fa:fa-pen-fancy Synthesis & Answer Gen)
    end

    subgraph Tools [Risk Tools & APIs]
        RiskCalc(fa:fa-calculator RiskCalculator<br>Python Function)
        SanctionsCheck(fa:fa-ban Sanctions List<br>API Check)
        
        subgraph Banking [Core Banking System]
            TransactionDB[(fa:fa-server Transaction Ledger<br>REST API)]
        end
        
        RiskCalc <-->|GET /transactions?clientId=123| TransactionDB
    end

    %% Relationships
    User ==>|1. Question| UI
    User ==>|2. Upload PDF| Upload
    
    Upload -->|PDF Stream| PyScript
    Embedder ==>|3. Index Embeddings| VectorStore

    UI ==>|4. User Question| Agent
    
    Agent <==>|5. Hybrid Search Query| VectorStore
    VectorStore -.->|Relevant Context| Agent

    Agent <==>|6. Tool Invocation| RiskCalc
    Agent <==>|7. Tool Invocation| SanctionsCheck

    Agent ==>|8. Final Answer| Synthesis
    Synthesis ==>|9. Response| UI

    %% Styling to mimic the Blue Theme
    classDef blue fill:#e3f2fd,stroke:#1565c0,stroke-width:2px;
    classDef green fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px;
    classDef orange fill:#fff3e0,stroke:#ef6c00,stroke-width:2px;
    classDef grey fill:#f5f5f5,stroke:#9e9e9e,stroke-width:2px;
    classDef red fill:#ffebee,stroke:#c62828,stroke-width:2px;

    class User,UI,Upload blue;
    class VectorStore,Index,ES orange;
    class Agent,Synthesis,Embedder green;
    class RiskCalc,SanctionsCheck grey;
    class DataPipeline blue;
    class TransactionDB red;
